name: Deploy to Google Apps Script

on:
  push:
    branches: [main]
  workflow_dispatch:  # ŸÑŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸäÿØŸàŸä ŸÖŸÜ ÿµŸÅÿ≠ÿ© Actions

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install clasp
        run: npm install -g @google/clasp

      - name: Check files to deploy
        run: |
          echo "üìÅ Files that will be deployed:"
          ls -la *.js *.json 2>/dev/null || echo "No JS/JSON files found"
          echo ""
          echo "üìÑ .clasp.json content:"
          cat .clasp.json

      - name: Create clasprc.json
        run: |
          echo '${{ secrets.CLASPRC_JSON }}' > ~/.clasprc.json
          if [ -s ~/.clasprc.json ]; then
            echo "‚úÖ clasprc.json created successfully"
          else
            echo "‚ùå ERROR: CLASPRC_JSON secret is empty or not configured!"
            exit 1
          fi

      - name: Push to Apps Script
        run: |
          echo "üöÄ Starting clasp push..."
          clasp push -f
          echo "‚úÖ Deployment completed successfully!"
