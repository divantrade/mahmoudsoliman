# نظام محمود المحاسبي - دليل التثبيت

## نظرة عامة

نظام محاسبي ذكي مبني على:
- **Google Sheets** - لتخزين البيانات
- **Google Apps Script** - للـ Backend
- **Telegram Bot** - للتفاعل (بنظام Polling)
- **Gemini AI** - لفهم اللغة الطبيعية

---

## خطوات التثبيت

### الخطوة 1: إنشاء Google Sheet

1. اذهب إلى [Google Sheets](https://sheets.google.com)
2. أنشئ ملف جديد باسم: **حسابات محمود**
3. احفظ رابط الملف

---

### الخطوة 2: ربط الـ Script بالـ Sheet

1. من Google Sheet، اذهب إلى:
   - **Extensions** (الإضافات) → **Apps Script**

2. ستفتح نافذة جديدة لـ Apps Script

3. احذف الكود الموجود وانسخ ملفات المشروع:
   - `Code.js`
   - `Config.js`
   - `GeminiAI.js`
   - `SheetsManager.js`
   - `TelegramPolling.js` ⭐ (مهم - بدلاً من TelegramHandler.js)
   - `Reports.js`

4. لإضافة ملف جديد:
   - اضغط على **+** بجانب Files
   - اختر **Script**
   - سمّ الملف (بدون .js)
   - انسخ المحتوى

---

### الخطوة 3: تحديث الإعدادات

في ملف `Config.js`، تأكد من صحة:

```javascript
const CONFIG = {
  TELEGRAM_BOT_TOKEN: 'YOUR_BOT_TOKEN',
  GEMINI_API_KEY: 'YOUR_GEMINI_KEY',
  // ...
};
```

---

### الخطوة 4: تشغيل البوت ⭐ (الأهم)

**شغّل دالة واحدة فقط: `setupBot`**

1. في القائمة المنسدلة (فوق)، اختر: **`setupBot`**
2. اضغط **Run** ▶️
3. إذا طلب صلاحيات:
   - اضغط **Review Permissions**
   - اختر حسابك
   - **Advanced** → **Go to ... (unsafe)**
   - **Allow**

4. ستصلك رسالة على التليجرام: "البوت يعمل بنجاح!"

---

### كيف يعمل البوت؟

البوت يستخدم نظام **Polling** (فحص دوري):
- يفحص الرسائل الجديدة كل **دقيقة**
- لا يحتاج Web App أو Webhook
- يعمل بشكل موثوق مع Google Apps Script

---

### الخطوة 5: إعداد المهام المجدولة (اختياري)

1. شغّل الدالة `createTriggers`
2. سيتم إنشاء:
   - فحص يومي للجمعيات (9 صباحاً)
   - تقرير أسبوعي (الجمعة 8 مساءً)
   - تقرير شهري (أول كل شهر)

---

## إضافة المستخدمين

### من الـ Sheet مباشرة

1. اذهب لشيت **المستخدمين**
2. أضف صف جديد:

| ID | Telegram_ID | الاسم | اسم_المستخدم | الصلاحية | نشط |
|----|-------------|-------|--------------|----------|-----|
| 1 | 123456789 | محمود | mahmoud | owner | نعم |
| 2 | 987654321 | الزوجة | wife | limited | نعم |

### الصلاحيات

| الصلاحية | الوصف |
|----------|-------|
| `admin` | صلاحيات كاملة + إدارة المستخدمين |
| `owner` | صلاحيات كاملة |
| `user` | تسجيل + تقارير محدودة |
| `limited` | تسجيل فقط |

---

## استخدام البوت

### بدء الاستخدام

1. افتح @mahmoud_solimanbot على Telegram
2. أرسل `/start`

### أوامر البوت

| الأمر | الوصف |
|-------|-------|
| `/start` | بدء الاستخدام |
| `/help` | دليل الاستخدام |
| `/report` | قائمة التقارير |
| `/monthly` | التقرير الشهري |
| `/wife` | تقرير الزوجة |
| `/siblings` | تقرير الإخوة |
| `/gold` | تقرير الذهب |
| `/associations` | تقرير الجمعيات |
| `/savings` | تقرير المدخرات |
| `/loans` | تقرير السلف |

### أمثلة على التسجيل

```
نزل الراتب 8500
صرفت 150 غداء
حولت لمراتي 3000 ريال وصلوا 4000 جنيه
دفعت الإيجار 2000
اشترت سارة 10 جرام ذهب عيار 21 بـ 4500
دفعت جمعية 5000 جنيه
أخذت سلفة من محمد 2000 ريال
```

---

## هيكل الشيتات

### 1. المستخدمين
تخزين بيانات وصلاحيات المستخدمين

### 2. الحركات
جميع المعاملات اليومية

### 3. التصنيفات
أنواع الدخل والمصروفات

### 4. جهات_الاتصال
أفراد العائلة والأسماء البديلة

### 5. الجمعيات
بيانات الجمعيات ومواعيدها

### 6. الذهب
سجل مشتريات الذهب

### 7. السلف
سجل السلف النشطة

### 8. سعر_الصرف
سجل أسعار الصرف

### 9. الإعدادات
إعدادات النظام

---

## استكشاف الأخطاء

### البوت لا يرد

1. تأكد من صحة الـ Bot Token
2. تأكد من نشر الـ Web App
3. شغّل `setWebhook` مرة أخرى
4. راجع Execution log في Apps Script

### خطأ في Gemini

1. تأكد من صحة الـ API Key
2. تأكد من تفعيل Gemini API في Google Cloud

### الشيتات فارغة

1. شغّل `initialize` مرة أخرى

---

## الدعم

للمساعدة أو الإبلاغ عن مشاكل:
- Telegram: @adelsolmn

---

## الإصدار

**Version:** 1.0.0
**Last Updated:** 2025
